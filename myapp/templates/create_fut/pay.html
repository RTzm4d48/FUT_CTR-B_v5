{% extends 'create_fut/base_form_new_fut.html' %}

{% load static %}
{% block linkstyle2 %}
<!-- Aun no estamos usando archivos .css -->
<!-- Los estilos base estan en 'base_from_new_fut.html' -->
{% endblock %}

{# ESTO LO ESTAMOS HEREDANDO DE BASE.HTML #}
{% block up_pop_space %}

<style>
    /*ESTOS SON LOS ESTILOS DEL POPUP PAY*/
    #pop_windows_2{
        margin: 150px auto auto auto;
      }
      .pop_up_window p{
        /* margin: 20px 10px; */
        opacity: 70%;
        font-size: smaller;
      }
      .area_title{
        width: 100%;
        height: auto;
        /* background: gray; */
        display: flex;
        flex-direction: column;
      }
      .area_title h3{
        margin: 5px auto;
        font-size: medium;
      }
      .save_inf{
        /* background: salmon; */
        display: flex;
        justify-content: center;
        height: auto;
      }
      .save_inf *{
        /* background: gold; */
        margin: 1px 2px;
        padding: 1px;
        color: #09AD72;
        height: 15px;
      }

      .area{
        width: 100%;
        /* background: #2c86da; */
        margin: 20px 0px;
        padding: 0px;
        display: flex;
        justify-content: space-between;
      }
      .area input[type="text"]{
        /* background: gold; */
        outline: 1px solid #838383;
        padding: 10px 5px;
        border-radius: 8px;
        border: none;
      }
      .text_1{
        width: calc(50% - 20px);
      }
      .area input[type="text"]:focus{
        outline: 1px solid #7679FA;
      }
      .buttons{
        display: flex;
        justify-content: space-between;
      }
      .buttons button{
        font-family: 'myfont_robot_bold';
        cursor: pointer;
        background: none;
        border: none;
        color: #3D9FF8;
      }
      .buttons button:hover{
        color: #2c86da;
      }
      .new_card{
        display: flex;
        /* background: pink; */
        width: 100%;
        border-radius: 6px;
        border: 1px solid #3838385d;
        cursor: pointer;
      }
      .new_card:hover{
        background: #0000000c;
      }
      .imagecard{
        height: 15px;
        margin: 3px auto 6px 5px;
      }
      .cont_card{
        /* background: greenyellow; */
        display: flex;
        flex-direction: column;
      }
      .card{
        display: flex;
        /* background: green; */
      }
      .card img{
        width: auto;
        height: 15px;
        margin: auto 2px;
      }
      .card p{
        margin: 5px 0px;
        font-family: 'myfont_robot_bold';
      }
      .warning{
        width: 100%;
        display: flex;
        background: #FFF7F4;
        padding: 15px 0px;
        border-radius: 7px;
      }
      .warning *{
        margin: 0px 5px;
        height: 15px;

      }
      .btn_save{
        margin: auto;
      }
      .btn_save button{
        padding: 5px 15px;
        border-radius: 5px;
        border: none;
        background: red;
        color: white;
        font-family: 'myfont_robot_bold';
        cursor: pointer;
      }
      .btn_save button:hover{
        background: #c70909;
      }
      /*AQUI ESTARAN LOS ESTILOS DE POPUP WAIT*/
      .pop_up_window{
        margin: 150px auto auto auto;
      }
      .icon_img{
        /*background: salmon;*/
        display: flex;
        width: 100%;
        flex-direction: column;
      }
      .icon_img img{
        margin: auto;
        height: 60px;
      }
      .texto_explicativo{
        display: flex;
        width: 80%;
        margin: 5px auto;
        background: #EDEDED;
        padding: 7px;
        height: 60px;
        border-radius: 4px;
      }
      .icon_img *{
        margin: 5px auto;
      }
      .input-file {
        display: none;
      }

      .select_img_cnt{
        /*background: green;*/
        width: 100%;
        height: 50px;
        display: flex;
        }

        /* Estilos para el botón personalizado */
        .custom_button {
          background-color: #007BFF;
          color: #fff;
          padding: 10px 20px;
          cursor: pointer;
          margin: auto;
          border: none;
          border-radius: 5px;
          top: 0px;
          justify-content: center;
            align-items: center;
            display: flex;
        
        }
        .custom_button img{
            height: 20px;
            margin: auto 5px;
        }
        .custom-button:hover {
          background-color: #0056b3;
        }
</style>
<!-- -----------Share------------- -->
<div id="pop_windows" class="pop_up_window_content ocultar">
  <div id="pop_windows_1" class="pop_up_window">
    <div onclick="close_pop_up()" class="close" style="right: 15px;">
      <svg viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="false" focusable="false"><path d="M181.088 135.936l1.536 1.44L512 466.741333l329.376-329.365333a32 32 0 0 1 46.688 43.712l-1.44 1.536L557.258667 512l329.365333 329.376a32 32 0 0 1-43.712 46.688l-1.536-1.44L512 557.258667 182.624 886.624a32 32 0 0 1-46.688-43.712l1.44-1.536L466.741333 512 137.376 182.624a32 32 0 0 1 43.712-46.688z"></path></svg>
    </div>
    <div class="area_title">
      <h3>Método de pago</h3>
      <div class="save_inf">
        <img src="{% static 'img/tps.png' %}" alt="">
        <p>tu información de pago está segura con nosotros</p>
      </div>
    </div>
    <div class="area">
      <div class="new_card" onclick="new_card()">
        <div class="radio">
          <input name="type_pay" type="radio" value="0" checked="checked"/>
        </div>
        <div class="cont_card">
          <div class="card"><img src="{% static 'img/card.png' %}" alt=""><p>Añadir una nueva targeta</p></div>
          <img class="imagecard" src="{% static 'img/visa.png' %}" alt="">
        </div>

      </div>
    </div>
    <div class="buttons ocultar">
      <button onclick="close_pop_up()">Descartar Tramite</button>
      <button onclick="close_pop_up()">Cancelar</button>
    </div>
  </div>
  <!-- - -->
  <div id="pop_windows_2" class="pop_up_window ocultar">
    <div onclick="new_card_back()" class="close" style="left: 15px;">
      <svg viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="false" focusable="false"><path d="M166.218667 471.285333l1.888-1.984 331.157333-331.157333a32 32 0 0 1 46.698667 43.722667l-1.44 1.536L247.146667 480.768h594.752a32 32 0 0 1 1.877333 63.946667l-1.877333 0.053333H247.146667l297.386666 297.376a32 32 0 0 1 1.429334 43.722667l-1.44 1.536a32 32 0 0 1-43.722667 1.44l-1.536-1.44L168.106667 556.234667a61.472 61.472 0 0 1-1.888-84.949334z"></path></svg>
    </div>
    <div class="area_title">
      <h3>Proporcionar más información</h3>
      <div class="save_inf">
        <img src="{% static 'img/tps.png' %}" alt="">
        <p>tu información de pago está segura con nosotros</p>
      </div>
    </div>
    <div class="area">
      <div class="warning">
        <img src="{% static 'img/card.png' %}" alt="">
        <p>Añade una nueva tarjeta</p>
        <img class="imagecard" src="{% static 'img/visa.png' %}" alt="">
      </div>
    </div>
    <div class="area">
      <input type="text" name="" class="text_1" placeholder='Número de tarjeta'>
      <input type="text" name="" class="text_1" placeholder='Nombre del titular de targeta' value="{{Name}}" id="">
    </div>
    <div class="area">
      <div class="subarea text_1" style="display: flex; justify-content: space-between;">
        <input type="text" name="" class="text_1" placeholder='MM'>
        <p style="margin: auto 0px;">/</p>
        <input type="text" name="" class="text_1" placeholder='YY'>
      </div>

      <input type="text" name="" class="text_1" placeholder='CVV'>
    </div>
    <div class="area">
      <div style="display: flex;">
        <div class="radio">
          <input name="type_pay" type="radio" value="0" checked="checked"/>
        </div>
        <p>Guardar esta targeta</p>
      </div>
    </div>
    <div class="area">
      <div class="btn_save">
        <button onclick="save_and_continue()">Guardar y continuar</button>
      </div>
    </div>
    <div class="buttons ocultar">
      <button onclick="close_pop_up()">Descartar Tramite</button>
      <button onclick="close_pop_up()">Cancelar</button>
    </div>
  </div>
</div>

<!-- {# ------------------------------------------ #} -->

<div id="pop_windows_wait" class="pop_up_window_content ocultar">
  <div class="pop_up_window">
    <!-- {# Context pop_up #} -->
    <div class="icon_img">
        <img src="{% static 'img/icon03.png' %}">
        <h2>Realize el pago</h2>
        <div class="texto_explicativo">
            <p>Aproximece a un cajero <strong>BCP</strong> y realice el pago a la siguiente cuenta <strong>3456 4567 4567 4523</strong>
            que se encuentra a nombre de <strong>Felipe Gonzales</strong> y luego tomele una foto al ticked y suba la foto aqui para su evaluación</p>
        </div>
        <div class="select_img_cnt">
          <input type="file" id="pdf_file" name="pdf_file" class="input-file" accept=".png, .jpg">

          <label for="pdf_file" class="custom_button">Seleccionar Imagen <img src="{% static 'img/img_icon.png' %}"></label>
        </div>
        <a href="http://127.0.0.1:8000/my_fut/proceedings?code=VvGodejkMHA">omitir por ahora</a>
    </div>
    <!-- {#/Context pop_up #} -->
  </div>
</div>

<!-- -------------------------------------------------- -->

<div id="pop_loader" class="pop_up_window_content ocultar">
    <!-- {# Context pop_up #} -->
    <style>
        /* Estilos de la ventana de carga */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .loader-text {
            color: white;
            margin: 0px 5px;
        }
        /* Estilos para la animación de carga (puedes personalizarlos según tus necesidades) */
        .loader-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db;
            border-top: 4px solid red;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <div class="loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">Cargando...</div>
    </div>
    <!-- {#/Context pop_up #} -->
</div>

{% endblock %}
{% block contentf %}
<!-- ------SOLO ESTILOS DEL CUADRO DE PAGO------ -->
<style>
    .content_form2{
        background: #ffffff;
        width: 60%;
        height: auto;
        margin: 20px auto;
        border-radius: 5px;
        padding: 5px 0px;
    }
    .block{
        width: 95%;
        /* background: salmon; */
        display: flex;
        margin: 5px auto;
    }
    .column1{
        width: 70%;
        height: auto;
        padding: 5px 0px;
        /* background: #5add26; */
    }
    .visa{
        height: 25px;
        margin: auto 10px auto 5px;
    }
    .column1 p{
        font-size: small; opacity: 80%;
        margin: 5px 0px;
    }
    .img_ctr{
        width: 100px;
    }
    .column1 h2{
        margin: auto 0px;
        opacity: 80%;
        font-size: medium;
    }
    .column2{
        width: 30%;
        height: 50px;
        /* background: #f8d50f; */
        display: flex;
    }
    .column2 a{
        font-size: smaller;text-align: center;margin: auto;
    }
    .pay_content{
        background: #6a6a6d1c;
        display: flex;        
        margin: 5px 0px;
        padding: 10px 0px;
        width: 80%;
        border-radius: 10px;
    }
    .pay_content img{
        display: flex;
        margin: auto 10px auto auto;
        width: auto;
        height: 17px;   
    }
    .radio{
        /* background: skyblue; */
        display: flex;
        margin: auto 5px auto 10px;
    }
    .dato_other{
        /* background: salmon; */
        display: flex;
        justify-content: space-between;
    }
    .dato_other p{
        font-size: medium;
        font-family: 'myfont_robot_bold';
        margin: 5px 10px 0px 10px;
    }
    .expandir{
        width: 100%;
    }
    .paycard{
        color: #3FA1E2;
        cursor: pointer;
    }
    .paycard:hover{
        color: #288ed1;
        text-decoration: underline;
    }
    .num_cuneta_cont{
        background: #80808038;
        display: flex;
        width: auto;
        margin: 5px auto;
        padding: 8px;
        border-radius: 7px;
    }
    .num_cuneta_cont img{
        height: 15px;
        margin: auto 0px;
        cursor: pointer;
    }
    .num_cuneta_cont img:hover{
        opacity: 70%;
    }
    .num_cuneta_cont p{
        margin: auto 5px;
        font-size: 15px;
    }
    .persona_cuenta{
        display: flex;
    }
    .persona_cuenta p{
        margin: auto 10px auto 0px;
    }
</style>

<div class="bodyf">
    <form id="id_form_pay" class="thefrom" action="{% url 'n_end' %}" method="post">
        {% csrf_token %}
    <div class="content_form">
        <div class="form_block">
            <div class="from_item">
                <!-- - -->
                <div class="content_form2 expandir">
                    <div class="block">
                        <div class="column1">
                            <img class="img_ctr" src="{% static 'img/fut_ctr-b.png' %}" alt="">
                            <p>Tarifa gestion: {{Monto}} PEN</p>
                        </div>
                        <div class="column2">
                        </div>
                    </div>
                    <hr>
                    <div class="block">
                        <div class="column1">
                            <p style="font-weight: bold;">Hola, {{Name}}:</p>
                            <p>Solo un paso más para realizar tu tramite.</p>
                        </div>
                        <div class="column2">
                            <a href="">mas información sobre metodos de pago</a>
                        </div>
                    </div>
                    <div class="block">
                        <div class="column1">
                            <p>metodo de pago:</p>
                            <div class="pay_content">
                                <div class="radio"><input class="opcion" name="typepay" type="radio" value="0" checked="checked" onclick="capturarValor(this)"/></div> Presencial por caja
                            </div>
                            <div class="pay_content">
                                <div class="radio"><input class="opcion" name="typepay" type="radio" value="5" onclick="capturarValor(this)"/></div>Pasarela de pago virtual
                                <img src="{% static 'img/visa.png' %}" alt="">
                            </div>
                        </div>
                        <div class="column2"></div>
                    </div>
                </div>
                <!-- - -->
            </div>
            <div class="from_item">
                <!-- - -->
                <div class="content_form2 expandir">
                    <div class="block">
                        <div class="column1 expandir">
                            <h2>Resumen</h2>
                            <p style="font-weight: bold;">Solicitud de {{Order}}</p>
                            <p>Costo Tramite: S/. {{Monto}}</p>
                            <p id="p_cargo">Cargo por Pasarela: S/. 0</p>
                            <hr>
                            <div class="dato_other">
                                <p>Total:</p>
                                <p id="p_total">S/. {{Monto}}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="content_form2 expandir">
                    <div class="block">
                        <div id="f_p_0" class="column1">
                            <h2 >Número de cuenta:</h2>
                            <div class="num_cuneta_cont">
                                <img src="{% static 'img/copy_icon.png' %}" alt="">
                                <p class="num_cuenta">9004 9954 7344 1030</p>
                            </div>
                            <div class="persona_cuenta">
                                <p style="font-family: 'myfont_robot_bold';" >Nombre:</p>
                                <p>Francisco Najar Delgado</p>
                            </div>
                        </div>
                        <div id="f_p_1" class="column1 ocultar">
                            <h2>Forma de pago</h2>
                            <p onclick="add_pay_card()" style="margin: 10px 0px 0px 0px;" class='paycard'>Seleccione forma de pago</p>
                        </div>
                        <div id="f_p_2" class="column1 ocultar">
                            <div style="display: flex;">
                                <img class="visa" src="{% static 'img/visa_sello.jpg' %}" alt="">
                                <h2>4557 88** **** 9055</h2>
                            </div>
                            <p onclick="add_pay_card()" style="margin: 10px 0px 0px 10px;" class='paycard'>Cambiar forma de pago</p>
                        </div>
                    </div>
                </div>
                <!-- - -->
            </div>
        </div>
        <div class="button_block">
            <div class="botons_display">
                <input type="hidden" name="name" value="{{Name}}">
                <input type="hidden" name="program" value="{{Program}}">
                <input type="hidden" name="dni" value="{{Dni}}">
                <input type="hidden" name="phone" value="{{Phone}}">
                <input type="hidden" name="cycle" value="{{Cycle}}">
                <input type="hidden" name="email" value="{{Email}}">

                <input type="hidden" name="myrequest" value="{{Myrequest}}">
                <input type="hidden" name="order" value="{{Order}}">
                <input type="hidden" name="reason" value="{{Reason}}">
                <input type="hidden" name="pdf_binary_encoded" value="{{Pdf_binary_encoded}}">

                <button type="button" onclick="window.history.back()">Volver</button>
                <button type="submit">Finalizar</button>
            </div>
        </div>
    </div>
    </form>
</div>
<script>
    // -----Variables
    var name_order = "{{Order}}";
    var monto = "{{Monto}}";
    var pop_windows_wait = document.getElementById("pop_windows_wait");
    var pop_loader = document.getElementById("pop_loader");
</script>
<script>
    document.getElementById("id_form_pay").addEventListener("submit", function (event) {
    event.preventDefault();//prevenimos el envio

    // OBTENEMOS EL RADIO
    const radios = document.querySelectorAll(".opcion"); // Seleccionar todos los radios con la clase "opcion"
    let opcionSeleccionada;
    for (const radio of radios) {
        if (radio.checked) {
            opcionSeleccionada = radio.value;
            break;
        }
    }
    console.log("el valor es:"+opcionSeleccionada);
    if (opcionSeleccionada == 0){
        //ABRIMOS POP-UP WAIT
        console.log("A");
        pop_loader.classList.remove("ocultar");
        //AREMOS UNA PETICION AJAX --------------------------
        //VARIABLES
        var nameValue = document.getElementsByName("name")[0].value;
        var programValue = document.getElementsByName("program")[0].value;
        var dniValue = document.getElementsByName("dni")[0].value;
        var phoneValue = document.getElementsByName("phone")[0].value;
        var cycleValue = document.getElementsByName("cycle")[0].value;
        var emailValue = document.getElementsByName("email")[0].value;

        var myrequest = document.getElementsByName("myrequest")[0].value;
        var order = document.getElementsByName("order")[0].value;
        var reason = document.getElementsByName("reason")[0].value;
        var emailValue = document.getElementsByName("pdf_binary_encoded")[0].value;
        console.log("el nombre es:"+ nameValue);
        $.ajax({
            type: 'GET',
            url: '/async-data/',  // Reemplaza con la URL de tu vista de carga de datos
            data: {
                'name': nameValue,
                'program': programValue,
                'dni': dniValue,
                'phone': phoneValue,
                'cycle': cycleValue,
                'email': emailValue,
                'myrequest': myrequest,
                'order': order,
                'reason': reason,
                // Agrega más variables según sea necesario
            },
            success: function(data) {
                // Ocultar la ventana de carga
                pop_loader.classList.add("ocultar");
                pop_windows_wait.classList.remove("ocultar");

                // Actualizar el contenido en la página
                console.log("Finalizado");
            },
            error: function() {
                // Manejar errores si es necesario
            }
        });
    }else{
        console.log("Bb");
    }
      // Realizar la validación
      // if (validarFormulario()) {
      //   // Envía el formulario si la validación es exitosa
      //   this.submit();
      // }
    });
    function capturarValor(radio) {
        var esp_cargo = "Cargo por Pasarela: S/. ";
        var esp_total = "S/. ";
        var taria = parseInt(monto);
        var f_p_0 = document.getElementById('f_p_0');
        var f_p_1 = document.getElementById('f_p_1');
        var f_p_2 = document.getElementById('f_p_2');

        if (radio.checked) {
            var valor = radio.value;
            var valor_int = parseInt(valor);
            
            document.getElementById("p_cargo").textContent = esp_cargo+valor;
            document.getElementById("p_total").textContent = esp_total + (taria + valor_int);
            if(valor!=0){
                f_p_0.classList.add('ocultar');
                f_p_1.classList.remove('ocultar');
                f_p_2.classList.add('ocultar');
            }else{
                f_p_0.classList.remove('ocultar');
                f_p_1.classList.add('ocultar');
                f_p_2.classList.add('ocultar');
            }
        }
    }
    function add_pay_card(){
        console.log("pay card");
        //var pop_windows fue creado en base.html
        pop_windows.classList.remove("ocultar");
    }
</script>
{% endblock %}


<!-- ----- -->
{% block check_1 %}
<!-- {% if name != '' %} -->
<p style="width: 30px; text-align: center;">✅</p>
<!-- {% else %}
{% endif %} -->
{% endblock %}
<!-- ----- -->



<!-- ----- -->
{% block check_2 %}
<!-- {% if name != '' %} -->
<p style="width: 30px; text-align: center;">✅</p>
<!-- {% else %}
{% endif %} -->
{% endblock %}
<!-- ----- -->


<!-- ----- -->
{% block navbaractivate_3 %}

activate-f

{% endblock %}
<!-- ----- -->