{% extends 'create_fut/base_form_new_fut.html' %}

{% load static %}
{% block linkstyle2 %}
<!-- Aun no estamos usando archivos .css -->
<!-- Los estilos base estan en 'base_from_new_fut.html' -->
{% endblock %}

{% block contentf %}
<!-- ------------DISTRIBUCIÓN DE LOS CONTENEDORES---------- -->
<style>
    .bodyf{
        width: 100%;
        height: calc(100% - 50px); /*restamos el espacio del nav bar*/
        /* background: gold; */
        /* opacity: 20%; */
        background: white;

    }
    .thefrom{
        /* background: darkcyan; */
        height: 100%;
        display: flex;
    }
    .content_form{
/*        background: green; */
        width: 90%;
        height: calc(100% - 30px);
        margin: 30px auto 0px auto;
        display: flex;
        flex-direction: column;
    }
    .form_block{
        /* background: pink; */
        width: 100%;
        height: 100px;
        margin: 20px 0px 0px 0px;
        display: flex;
        justify-content: space-between;
    }
    .from_item{
        /* background: skyblue; */
        width: 45%;
        height: 100%;
        float: left;
        display: flex;
        flex-direction: column;
    }
    .from_item label{
        margin: auto 10px;
    }
    .group {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: relative;
      /* background: salmon; */
    }
    .button_block{
        width: 100%;
        margin: auto 0px 20px 0px;
        display: block;
        display: flex;
        height: auto;
        /* background: saddlebrown; */
    }
    .botons_display{
        /* background: blue; */
        width: 100%;
        margin: auto;
        display: flex;
        justify-content: space-between;
    }
    .botons_display button{
        border: none;
        border-radius: 5px;
        color:white;
        background: red;
        width: 90px;
        height: 30px;
        cursor: pointer;
    }
    .botons_display button:hover{
        background: rgb(196, 17, 17);
    }
</style>
<!-- ------------SOLO ESTILOS DEL 'LIST' PARA SELECCIONAR LOS TRAMITES---------- -->
<style>
    .content_boxlist{
        display: flex;
        width: 100%;
        justify-content: space-between;
        border-radius: 10px;
        height: 50px;
        color: gray;
        border: 1px solid gray;
        cursor: pointer;
        margin: 0px 0px auto auto;
    }
    .boxlist_inner{
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: space-between;
        background: #E9E9E9;
        border-radius: 10px;
    }
    .boxlist_inner p{
        margin: auto 5px;
    }
    .content_boxlist:hover{
        border: 1px solid black;
    }
    .content_boxlist p{
        margin: auto 10px;
        color: black;
    }
    .icono{
        height: 30px;
        margin: auto 10px;
    }
    .list_activate{
        border: 0px solid red;
    }
    .list_activate:hover{
        border: 0px solid red;
    }
    .content_boxlist2{
        background: #E9E9E9;
        width: 100%;
        height: 310px;
        z-index: 2;
        border-radius: 10px;
        border: 1px solid gray;
        box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3); /* Sombras */
    }
    .search_content{
        width: 80%;
        height: 40px;
        margin: 10px auto;
        /* background: gray; */
        display: flex;
        position: relative;
    }
    .txt_search{
        background: white;
        height: 100%;
        width: 100%;
        padding: 0px 10px;
        font-size: 13px;
        border: none;
        border-radius: 3px;
    }
    .txt_search:focus {
        outline: 1px solid #7679FA;
    }
    .svg_search{
        /* background: pink; */
        display: flex;
        width: 25px;
        position: absolute;
        top: 50%; /* Centra verticalmente */
        right: 5px; /* Posición a la derecha */
        transform: translateY(-50%); /* Corrige la posición vertical para centrar */
    }
    .procedure_content{
        width: 100%;
        height: calc(100% - 100px);
        /* background: salmon; */
    }
    .close_conte{
        width: 100%;
        height: 40px;
        /* background: #272ae4; */
        display: flex;
    }
    .close_conte p{
        background: gray;
        color: white;
        margin: 10px auto auto auto;
        padding: 2px 15px;
        border-radius: 3px;
        font-size: small;
        border: 1px solid #5e5e5e;
    }
    .close_conte p:hover{
        background: #686868;
    }
    .procedure{
        width: 100%;
        height: 30px;
        display: flex;
        color: black;
        /* background: red; */
    }
    .procedure:hover{
        background: #9cbaf1af;
    }
    .procedure img{
        height: 70%;
        margin: auto 0px auto 15px;
        opacity: 70%;
    }
    .procedure p{
        font-size: small;
        margin: auto 15px auto 10px;
        opacity: 80%;
    }
    .color_procedure{
        background: #afafaf56;
    }
    .ocultar{
        display: none;
    }
    .mostrar{
        display: flex;
    }
    .error_list{
        background: rgba(255, 0, 0, 0.281);
    }
</style>

<!-- ------------SOLO ESTILOS DEL 'TEXTAREA'---------- -->
<style>
    * {
      box-sizing: border-box;
    }
    textarea {
      display: block;
      width: 100%;
      padding-top: 20px;
      padding-left: 20px;
      border: none;
      color: black;
      font-size: 20px;
      font-family: Arial, Helvetica, sans-serif;
      transition: 0.3s ease;
      margin: auto;
      font-size: small;
      height: 95%;
      border-radius: 3px;
    }
    textarea:valid ~ label {
      color: black;
    }
    textarea:focus {
      outline: none;
    }
    textarea:focus ~ label {
      color: black;
    }
    textarea:focus ~ .bar:before {
      transform: translateX(0);
    }
    textarea:-webkit-autofill {
      -webkit-box-shadow: 0 0 0px 1000px red inset;
      -webkit-text-fill-color: white !important;
    }
    select::-ms-expand {
      display: none;
    }
</style>

<div class="bodyf">
    <form id="myform" class="thefrom" action="{% url 'n_pay' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
    <!-- NUEVO CONTENEDOR FORM---------------- -->
    <style>
        .content2_form{
            width: 80%;
            margin: 0px auto;
/*            background: yellow;*/
            display: flex; /*IMPORTANTE*/
            flex-direction: column;
        }
        .content2_form .TheTitle{
            font-size: large;
            margin: 15px auto 5px auto;
        }
        .content2_form p{
/*            margin: 0px auto;*/
        }
        .fila_form{
            width: 70%;
            margin: 30px auto 0px auto;
/*            background: salmon;*/
            display: flex;
            justify-content: space-between;
        }
        .unEspacio_mediano{
            width: calc(50% - 10px);
/*            background: red;*/
            display: flex;
            position: relative; /*importante*/
        }
        .unEspacio_mediano input[type="text"]{
            width: calc(100% - 0px);/*MENOS EL PADDING DEL inpur text*/
            padding: 8px 10px;
            margin: 0px;
            border: 1px solid gray;
            border-radius: 10px;
        }
        .unEspacio_mediano input[type="text"]:focus{
            outline: none;
        }
        .unEspacio_mediano label{
            position: absolute;/*importante*/
            top: -8px;
            background: white;
            color: gray;
            left: 15px;
            padding: 0px 5px;
        }
        .unEspacio_entero{
            width: 100%;
/*            background: red;*/
            display: flex;
            position: relative; /*importante*/
        }
        .unEspacio_entero input[type="text"]{
            width: 100%;
            padding: 8px 10px;
            margin: 0px;
            border: 1px solid gray;
            border-radius: 10px;
        }
        .unEspacio_entero input[type="text"]:focus{
            outline: none;
        }
        .unEspacio_entero label{
            position: absolute;/*importante*/
            top: -8px;
            background: white;
            color: gray;
            left: 15px;
            padding: 0px 5px;
        }
        .cont_buttons_form{
/*            background: purple;*/
            width: 50%;
            margin: 30px auto 0px auto;
            display: flex;
            justify-content: space-between;
        }
        .cont_buttons_form button{
            height: 30px;
            background: #E1004D;
            color: white;
            border: none;
            display: flex;
            justify-content: center; /*IMPORTANTE*/
            align-items: center; /*IMPORTANTE*/
            padding: 2px 10px;
            border-radius: 40px;
            cursor: pointer;
        }
        .cont_buttons_form button:hover{
            background: #B90B47;
        }
        .cont_buttons_form img{
            height: 50%;
            margin: auto 5px;
        }
        .ocultar{
            display: none;
        }
    </style>
    <!-- ----STILOS DE AGREGADO SOLO PARA PROCESS--- -->
    <style>
        .unEspacio_entero textarea{
            width: 100%;
            padding: 8px 10px;
            margin: 0px;
            border: 1px solid gray;
            border-radius: 10px;
        }
        .select_img_cnt{
            width: 100%;
/*            background: yellow;*/
            height: 100%;
        }
        .select_img_cnt input{
            display: none;
        }
        .select_img_cnt label{
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center; /*IMPORTANTE*/
            align-items: center; /*IMPORTANTE*/
            border-radius: 10px;
            color: black;
            top: 0px;
            left: 0px;
            background: #E9E9E9;
            border: 1px solid gray;
            font-size: small;
            cursor: pointer;
        }
        .select_img_cnt .red_text{
            color: #3B57AC;
        }
        .select_img_cnt label:hover{
            border: 1px solid black;
        }
        .select_img_cnt label img{
            height: 15px;
            margin: auto 5px;
        }
        .select_img_cnt .red_class{
            background: #F8D6DA;
        }
        .red_c{
            border: 1px solid red;
        }
        .content_boxlist .blue_color{
            color: #3B57AC;
        }
    </style>
    <div class="content2_form">
        <p class="TheTitle">Proceso Tramite</p>
        <p style="margin: 0px auto;">Por favor indique el tramite que realizara y los motivos.</p>
        <p id="id_pross_advertencia" class="ocultar" style="margin: 0px auto; color: red;"></p>
        <!-- - -->
        <div class="fila_form" style="height: 40px;">
            <div class="unEspacio_mediano" style="flex-direction: column;">
                <!-- -SELECCIONAR TRAMITE- -->
                <div class="content_boxlist" id='boxlist' style="margin:0px">
                    <!-- - -->
                    <div id="list_show_01" title="" class='boxlist_inner' onclick='show_list()'>
                        <p id='select_procedure' style=" display: flex; align-items: center;"><img style="height: 15px; margin: auto 5px;" src="/static/img/procedure2.png" alt=""> Seleccionar Tramite</p>
                        <div class='icono'>
                            <svg style='pointer-events: none; display: block; width: 100%; height: 100%;' viewBox='0 0 24 24' preserveAspectRatio='xMidYMid meet' focusable='false'><g><path fill='gray' d='M18,9l-6,6L6,9H18z'></path></g></svg>
                        </div>
                    </div>
                    <!-- - -->
                    <div id="list_show_02" class='content_boxlist2 ocultar'>
                        <div class='search_content'>
                            <input class='txt_search' type='text' id='miCuadroDeTexto' placeholder='Busca el tramite que deseas' oninput='event_search()'>
                            <div class='svg_search'>
                                <svg viewBox='0 0 24 24' preserveAspectRatio='xMidYMid meet' focusable='false' style='pointer-events: none; display: block; width: 100%; height: 100%;'><g><path d='M20.87,20.17l-5.59-5.59C16.35,13.35,17,11.75,17,10c0-3.87-3.13-7-7-7s-7,3.13-7,7s3.13,7,7,7c1.75,0,3.35-0.65,4.58-1.71 l5.59,5.59L20.87,20.17z M10,16c-3.31,0-6-2.69-6-6s2.69-6,6-6s6,2.69,6,6S13.31,16,10,16z'></path></g></svg>
                            </div>
                        </div>
                        <div class='procedure_content' id='procedures' style='overflow-y: scroll;'>
                        </div>
                        <div class='close_conte'>
                            <p onclick='hide_list(0)'>Close</p>
                        </div>
                    </div>
                    <!-- - -->
                </div>
                <p id="alert_tramite" style="color:red; margin: 0px;padding: 0px;" class="ocultar">*Seleccione un tramite antes de continuar</p>
                <!-- -/- -->
            </div>
            <div class="unEspacio_mediano">
                <div class="select_img_cnt">
                    <input type="file" id="attachfile" name="attach_file"  accept=".png, .jpg, .pdf">
                    <label id="id_attach_label" class="" for="attachfile"><img src="{% static 'img/adjuntar.png' %}">Adjuntar Archivo (opcional)</label>
                </div>
            </div>
        </div>
        <!-- - -->
        <div id="id_cont_require" class="fila_form ocultar">
            <div id="espace_solicito" class="unEspacio_entero">
                <input id="id_solicito" type="text" class="red_c" name="myrequest" value="" placeholder="Especifique que es lo que quiere solicitar">
                <label>Solicito</label>
            </div>
        </div>
        <!-- - -->
        <div class="fila_form">
            <div class="unEspacio_entero">
                <textarea id="name" name="reason" cols="10" rows="5" placeholder="Ingrese el motivo por el que esta haciendo esta solicitud." required></textarea>
                <label>Que por motivos de:</label>
            </div>
        </div>
        <!-- - -->
        <div class="cont_buttons_form">
            <!-- LO QUE RECIBIMOS DE IDENTIFICACIÓN -->
            <input type="hidden" name="name" value="{{ Name }}">
            <input type="hidden" name="full_name" value="{{ Full_name }}">
            <input type="hidden" name="email" value="{{ Email }}">
            <input type="hidden" name="phone" value="{{ Phone }}">
            <input type="hidden" name="dni" value="{{ Dni }}">
            <input type="hidden" name="cycle" value="{{ Cycle }}">
            <input type="hidden" name="program" value="{{ Program }}">
            <input type="hidden" name="order" value="">
            <input type="hidden" name="order_id" value="">

            <input id="input_attach" type="hidden" name="input_attach" value="">

            <button onclick="window.history.back()"><img src="{% static 'img/former_form.png' %}" alt="">Anterior</button>
            <p></p>
            <button type="submit">Siguiente<img src="{% static 'img/next_form.png' %}" alt=""></button>
        </div>
    </div>
    </form>
</div>
<script>
    var list_show_01 = document.getElementById("list_show_01");
    var divContenedor = document.getElementById("boxlist");
    var list_show_02 = document.getElementById("list_show_02");
    var select_procedure = document.getElementById('select_procedure');
    var form = document.getElementById('myform');
    var message_alert = document.getElementById("alert_tramite");

    function show_list(){
        list_show_02.classList.remove("ocultar");
        list_show_01.classList.add("ocultar");
        message_alert.classList.add("ocultar");
        divContenedor.classList.add("list_activate");
        event_search();
    }
    function hide_list(procedure){
        if(procedure == 0){// significa que esta funcion fue ejecutada con el botón 'ocultar' asi que solo copiamos el textContent de la etiqueta 'p'
            procedure = select_procedure.textContent;
        }
        list_show_01.classList.remove("ocultar");
        list_show_01.classList.remove("error_list");
        list_show_02.classList.add("ocultar");
        list_show_01.title = procedure;


        let short_procedure = paint_file2(procedure);
        select_procedure.innerHTML = `<img style="height: 15px; margin: auto 5px;" src="/static/img/procedure2_blue.png" alt="">${short_procedure}</p>`;
        select_procedure.classList.add("blue_color");
        divContenedor.classList.remove("list_activate");
    }
    function event_search(){
        // Obtén el valor actual del campo de entrada
        var texto = document.getElementById("miCuadroDeTexto").value;
        // Muestra el valor en la consola
        var cont_procedures = document.getElementById("procedures");// id contenedor
        cont_procedures.innerHTML = "";
        //AJAX
        $.ajax({
            url: "/procedures_list/", // ruta en url.py para que ejecute una funcion
            method: "GET",
            data:{
                'tipeo':texto,
            },
            success: function(response){
                const midata = response;
                console.log(midata);
                for (var i = 0; i < midata['message']['length']; i++) {

                    if(i % 2 == 0){
                        cont_procedures.innerHTML += "<div class='procedure color_procedure' onclick='select_proc("+midata['message'][i]['id']+")'>"+
                        "<img src='/static/img/procedure2.png' alt=''>"+
                        "<p style='margin:auto 0px auto 10px;'>"+midata['message'][i]['id']+"</p><p id='proc"+midata['message'][i]['id']+"_id'>"+midata['message'][i]['tipo_de_servicio']+"</p>"+
                        "</div>";
                    }else{
                        cont_procedures.innerHTML += "<div class='procedure' onclick='select_proc("+midata['message'][i]['id']+")'>"+
                        "<img src='/static/img/procedure2.png' alt=''>"+
                        "<p style='margin:auto 0px auto 10px;'>"+midata['message'][i]['id']+"</p><p id='proc"+midata['message'][i]['id']+"_id'>"+midata['message'][i]['tipo_de_servicio']+"</p>"+
                        "</div>";
                    }
                }
            },
            error: function() {
                alert("Ocurrió un error al cargar el contenido.");
            }
        });
    }

    function validacion_proccess(midata){
        if(midata['data']['tipo_de_servicio'] == "Otros"){
            // document.getElementById("id_solicito").disabled = false;
            document.getElementById("id_cont_require").classList.remove("ocultar");
            window.solicito = true;
        }else{
            // document.getElementById("id_solicito").disabled = true;
            document.getElementById("id_cont_require").classList.add("ocultar");
            window.solicito = false;
        }
        if(midata['data']['require_attach'] == true){
            let te_pros = midata['data']['procedimiento'];
            document.getElementById("id_pross_advertencia").innerHTML = te_pros;
            window.valid_attach = true
            console.log(midata['data']['procedimiento']);
        }else{
            window.valid_attach = false
        }
    }

    function get_tupa_validation(num){
        //AJAX
        $.ajax({
            url: "/tupa_validation_path/",
            method: "GET",
            data:{
                'id_tupa': num,
            },
            success: function(response){
                const midata = response; //en response esta recibiendo el return de la funcion
                validacion_proccess(midata);
            },
            error: function() {
                alert("Ocurrió un error al cargar el contenido.");
            }
        });
    }

    function select_proc(num){
        var procedure = document.getElementById('proc'+num+'_id');// obtenemos el valor del procedure seleccionado

        // escribimos en el value del input oculto para que se envie el dato con el formulario
        var orderInput = document.querySelector('input[name="order"]');
        var orderInput_id = document.querySelector('input[name="order_id"]');

        orderInput.value = procedure.textContent;
        orderInput_id.value = num;
        document.getElementById("id_solicito").value = '';
        get_tupa_validation(num);


        hide_list(procedure.textContent);// enviamos lo que camturamos el content de la etiqueta 'p'
    }

    //window.solicito

    //SUBIR BAUCHER-----
    var attachfile = document.getElementById("attachfile");
    attachfile.addEventListener('change', function(event){
        // Obtener la lista de archivos seleccionados
        var archivos = event.target.files;

        // Hacer algo con los archivos seleccionados
        for (var i = 0; i < archivos.length; i++) {
            const name = archivos[i].name;

            document.getElementById("id_attach_label").classList.add("red_text");

            let short_name = paint_file(name);
            document.getElementById("id_attach_label").innerHTML = `<img src="{% static 'img/adjuntar_blue.png' %}">${short_name}`;
            document.getElementById('input_attach').value = 'true';
        }
    });
    function paint_file(name){
        if (name.length > 20) {
            if(name.length > 24){
                var shortened_name = name.substring(0, 20);
                var tipo = name.substring(name.length - 3);
                return shortened_name+'...'+tipo;
            }else{
                var shortened_name = name.substring(0, 16);
                var tipo = name.substring(name.length - 3);
                return shortened_name+'...'+tipo;
            }
        }else{
            return name;
        }
    }
    function paint_file2(name){
        if (name.length > 30) {
            var shortened_name = name.substring(0, 30);
            return shortened_name+'...';
        }else{
            return name;
        }
    }
    //Evento Prevent Para asegurarnos que se seleccione un tramite
    form.addEventListener('submit', function(event){
        var text_solicito = document.getElementById("id_solicito").value;
        var text_attach = document.getElementById("input_attach").value;
        var orderInput_id = document.querySelector('input[name="order_id"]');

        if(orderInput_id.value == ""){
            list_show_01.classList.add("error_list");
            message_alert.classList.remove("ocultar");
            event.preventDefault();
        }else if(text_attach == '' && window.valid_attach == true){
            document.getElementById("id_pross_advertencia").classList.remove("ocultar");
            document.getElementById("id_attach_label").classList.add("red_class");
            document.getElementById("id_attach_label").innerHTML = `<img src="{% static 'img/adjuntar.png' %}">Adjuntar Archivo`;
            event.preventDefault();
        }else if(text_solicito == "" && window.solicito == true){
            document.getElementById("espace_solicito").classList.add("red_c");
            event.preventDefault(); // Detiene el envío del formulario
        }
    });
</script>
{% endblock %}

<!-- ----- -->
{% block check_1 %}
<!-- {% if name != '' %} -->
<p style="margin: auto 2px;">✅</p>
<!-- {% else %}
{% endif %} -->
{% endblock %}
<!-- ----- -->

<!-- ----- -->
{% block navbaractivate_2 %}

activate-f

{% endblock %}
<!-- ----- -->
