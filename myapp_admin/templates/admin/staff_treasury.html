{% extends 'layouts/mainadmin.html' %}
{% load static %}

{% block position %}
<h2 class="position">/ {{Data_log.position_admin2}} </h2>
{% endblock %}

{% block content %}
<style>
    @font-face {
        font-family: 'sans_italic';
        src: url('/static/fonts/OpenSans_SemiCondensed-Regular.ttf') format('truetype')
    }
    @font-face {
        font-family: 'myfont_robot_normal';
        src: url('/static/fonts/Roboto-Regular.ttf') format('truetype')
    }
    /*@font-face {
        font-family: 'sans_italic_Bold';
        src: url('/static/fonts/OpenSans_SemiCondensed-SemiBold.ttf') format('truetype')
    }*/
    .block_container{
        /* background: red; */
        width: 100%;
        height: auto;
        margin: 10px 0px;
    }
    .block_bloker{
        width: 100%;
        height: auto;
        /* background: pink; */
        display: flex;
    }
    .block_one{
        width: 20%;
        height: calc(100vh - 80px);
        background: #464646;
        margin: 0px 10px 0px auto;
        border-radius: 4px;
    }
    .block_two{
        width: calc(80% - 30px);
        height: calc(100vh - 80px);
        /*background: green;*/
        margin: 0px auto 0px 0px;
        display: flex;
        flex-direction: column;
    }
    #cont_ayelash{
        /*background: salmon;*/
        height: 100vh;
    }
    .ayelash{
        width: 100%;
        height: 7.45%;
        background: #464646;
        margin: 0px 0px 5px 0px;
        display: flex;
        justify-content: space-between;
        /* font-weight: bold; */
        text-decoration: none;
        color: white;
        border-radius: 4px;
    }
    .ayelash_color{
        background: #5C5C5C;
    }
    .ayelash:hover{
        background: #707070;
    }
    /* ----------------------------------------------------- */
    .info1{
        /* background: red; */
        display: block;
        margin: 15px 0px;
    }
    .name{
        /* background:green; */
        font-size: large;
        opacity: 80%;
        margin: 20px 0px 0px 0px;
        display: block;
    }
    .name p{
        margin: 0px 10px;
        font-size: smaller;
    }
    .name2{
        background: rgb(82, 82, 82);
        display: flex;
        
        margin: 10px 0px 0px 0px;
        padding: 10px;
    }
    .name2 .signal{
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin: auto 0px;
    }
    .name2 .eltext{
        margin: 0px auto 0px 10px;
        font-weight: bold;
    }
    .numb{
        margin: 0px 10px 0px auto;
        font-weight: bold;
    }
    .red_a{
        color: red;
    }
    .green_a{
        color: #1be61b;
    }
    .red_b{
        background: red;
    }
    .green_b{
        background: #1be61b;
    }
    .label{
        /* background: pink; */
        padding: 10px 2px;
    }
    .label1{
        background: rgb(83, 83, 83);
        /*background: darkblue;*/
        margin: 5px 0px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        padding: 6px;
        color: white;
        text-decoration: none;
        font-size: smaller;
    }
    .label1:hover{
        background: rgb(117, 117, 117);
    }
    .filauno{
        width: 30%;
        /* background: salmon; */
        display: flex;
        font-family: 'sans_italic';
    }
    .filauno h2{
        background: #707070;
        padding: 1px 20px;
        margin: 10px 1px;
        text-align: center;
        align-items: center;
        display: flex;
        border-radius: 5px;
        font-size: smaller;
        opacity: 70%;
    }
    .filauno p{
        font-size: medium;
    }
    .filados{
        width: 70%;
        /*background: red; */
        display: flex;
    }
    .ayelash p{
        margin: auto 7px;
        font-size: smaller;
    }
/* ----------------------------- */
    .navbar_extra{
        display: flex;
        justify-content: space-between;
        /*background: red;*/
        height: 8%;
        font-size: smaller;
        margin: 0px 0px 5px 0px;
    }
    .prncipalcoso{
        /*background: #716AD1;*/
        height: 100%;
        margin: 0px auto 10px 0px;
        display: flex;
    }
    .label_principal{
        /* background: salmon; */
        border-bottom: 3px solid rgb(52, 101, 236);
        justify-content: center;
        width: 200px;
        align-items: center;
        display: flex;
        justify-content: center;
        margin: 0px 10px 0px 0px;
    }
    .label_principal p{
        margin: 2px;
        font-weight: bold;
        opacity: 90%;
    }
    .label_principal .paa{
        background: green;
        padding: 4px;
        border-radius: 20px;
        font-size: smaller;
    }
    .chanel_cont{
        display: flex;
    }
    .chanel_cont p{
        font-size: small;
        margin: auto 2px;
    }
    .chanels{
        /* background: #1be61b; */
        width: 25px;
        height: 25px;
        align-items: center;
        text-align: center;
        margin: auto 10px;
        opacity: 90%;
        cursor: pointer;
    }
    .chanels p{
        margin: 0px;
        padding: 0px;
        font-weight: bold;
        font-size: 20px
    }
    .chanels:hover{
        opacity: 50%;
    }
    .data_fut{
        display: flex;
        opacity: 80%;
        font-weight: bold;
    }
    .new{
        font-weight: bold;
        color: #27b627;
    }
    .report{
        font-weight: bold;
        color: red;
        background: #7F3C3C;
        padding: 5px 10px;
        border-radius: 3px;
    }
</style>
<div class="block_container">
    <div class="block_bloker">
        <div class="block_one">
            <div class="info1">
                <div class="name"><p>{{Data_log.position_admin1}} - {{Data_log.admin_name}}</p></div>
                <div class="name2"><div class="signal green_b"></div><p class="eltext">pendientes</p><p class="numb green_a">{{Data_log.num_futs}}</p></div>
            </div>
            <div class="label">
                <a href="{% url 'n_staff_treasury' %}" class="label1"><img width="20px" height="20px" style="margin: auto 7px;" src="{% static 'img/procedure.png' %}" alt="">Todos</a>
                <a href="{% url 'n_postulated' %}" class="label1"><img width="20px" height="20px" style="margin: auto 7px;" src="{% static 'img/icon02.png' %}" alt="">Pospuestos</a>
                <a href="{% url 'n_send' %}" class="label1"><img width="20px" height="20px" style="margin: auto 7px;" src="{% static 'img/send.png' %}" alt="">Procesados</a>
<<<<<<< HEAD
                <!-- <a href="{% url 'n_reported' %}" class="label1"><img width="20px" height="20px" style="margin: auto 7px;" src="{% static 'img/direction.png' %}" alt="">Reportados</a> -->
=======
>>>>>>> f6edc0742060b0c2413c7212ea9832dfa6a7ff3b
            </div>
        </div>
        <div class="block_two" id="miContenedor">
            {% block fut %}

            {% if Len_list_data != 0 %}
            <div class="navbar_extra">
                <div class="prncipalcoso">
                    <div class="label_principal"><p>Principal</p></div>
                    <div class="label_principal">
                        <p>No Leidos</p>
                        {% if views == 0 %}
                            <p class="paa" style="background: #5C5C5C;">{{views}} Nuevos</p>
                        {% else %}
                            <p class="paa">{{views}} Nuevos</p>
                        {% endif %}
                    </div>
                </div>
                <div class="chanel_cont">
                    <div class="chanels">
                        <p onclick="before()">&lt;</p>
                    </div>
                        <p id="id_page"> <strong>1</strong></p>
                        <p>-</p>
                        <p><strong>{{role}}</strong></p>
                    <div class="chanels">
                        <p onclick="next()">&gt;</p>
                    </div>
                </div>
            </div>

            <div id="cont_ayelash">
            <!-- pesttañas -->
            {% for i in Object %}
                <a href='/ils_admin/staff/fut?code={{i.code}}&mode=1' class='ayelash {% if i.view == 0 %}ayelash_color{% endif %}'>
                    <div class='filauno'><img width='25px' height='25px' style='margin: auto 7px;' src='/static/img/procedure.png' alt=''>
                        <h2>{{i.num}}</h2>
                        <p>{{i.order}}</p>
                    </div>
                    <div class='filados'>
                        <p>{{i.reason}}</p>
                        <p>-</p>
                        <p>{{i.name}}</p>
                        {% if i.report_state != False %}
                        <p class='report'>Reportado</p>
                        {% endif %}

                        {% if i.view == 0 %}
                        <p class='new'>/Nuevo</p>
                        {% endif %}{% if i.stage == 1 %}
                        <p class='data_fut' style='color: orange; margin: auto 20px auto auto;'>/Pospuesto - {{i.date}}</p>
                        {% elif i.stage == 2 %}
                        <p class='data_fut' style='color: skyblue; margin: auto 20px auto auto;'>/Pendiente - {{i.date}}</p>
                        {% else %}
                        <p class='data_fut' style='margin: auto 20px auto auto;'>{{i.date}}</p>
                        {% endif %}
                    </div>
                </a>
            {% endfor %}
            <!-- fin-pestañas -->
            </div>
            
            {% else %}

                        
            <style>
                .empty{
                    /* background: red; */
                    display: block;
                    text-align: center;
                    margin: 200px auto;
                }
            </style>

            <div class="empty">
                <img src="{% static 'img/empty.png' %}" alt="">
                <h1>No Hay Datos</h1>
            </div>

            {% endif %}

            {% endblock %}
            
        </div>
    </div>
</div>
<script>
//esto es para obtener variables
//este script se quedara en el html
var role = "{{role}}";
</script>

<script>
    $(document).ready(function() {
        $("#miEnlace").click(function(event) {
            event.preventDefault(); // Evita que se siga el enlace por defecto

            // Realiza la solicitud AJAX
            $.ajax({
                url: "{% url 'n_view_fut' %}", // Ruta del archivo que contiene el contenido actualizado
                method: "GET",
                success: function(response) {
                    $("#miContenedor___").html(response); // Actualiza el contenido del div con la respuesta del servidor
                },
                error: function() {
                    alert("Ocurrió un error al cargar el contenido.");
                }
            });
        });
    });

    function closeForm(){
        document.getElementById("login-form-popup").style.display = "none";
    }
    function next(){
        //chanel_page('next');
    }
    function before(){
        //chanel_page('before');
    }
    function chanel_page(action){
        event.preventDefault(); // Evita que se siga el enlace por defecto
        const page = document.getElementById('id_page');
        const pageText = page.textContent;
        // Realiza la solicitud AJAX
        $.ajax({
            url: "/ils_admin/staff_treasury2", // Ruta del archivo que contiene el contenido actualizado
            method: "GET",
            data:{
                'page':pageText,
                'role':role,
                'action': action
            },
            success: function(response) {
                page.textContent = response.new_page
                //process
                const data = response.data;
                const contenedor = document.getElementById("cont_ayelash");
                const direction = "{% static 'img/procedure.png' %}"
                console.log("la direccion es:"+direction)
                //creamos el div
                contenedor.innerHTML = '';
                for (let i = 0; i < data['length']; i++){
                    //estado pospuesto o pendiente
                    var estado="<p></p>";
                    if(data[i]['stage']==1){ //POSPUESTO
                        estado = "<p class='data_fut' style='color: orange;margin: auto 20px auto auto;'>/Pospuesto - "+data[i]['date']+"</p>";
                    }else if(data[i]['stage']==2){//PENDIENTE
                        estado = "<p class='data_fut' style='color: skyblue;margin: auto 20px auto auto;'>/Pendiente - "+data[i]['date']+"</p>";
                    }else{
                        estado="<p class='data_fut' style='margin: auto 20px auto auto;'>"+data[i]['date']+"</p>";
                    }
                    var new_fut="";
                    var class_view="";
                    if(data[i]["view"]==0){
                        new_fut="<p class='new'>/Nuevo</p>";
                        class_view="ayelash_color";
                    }


                    // contenido del  div
                    const div = document.createElement('div');
                    div.innerHTML="<a href='/ils_admin/staff/fut?code="+data[i]['code']+"&mode=1' class='ayelash "+class_view+"'>"+
                    "<div class='filauno'><img width='25px' height='25px' style='margin: auto 7px;' src='/static/img/procedure.png' alt=''>"+
                        "<h2>"+data[i]['num']+"</h2>"+
                        "<p>"+data[i]['order']+"</p>"+
                    "</div>"+
                    "<div class='filados'><p>"+data[i]['reason']+"</p><p>-</p><p>"+data[i]['name']+"</p>"+new_fut+estado+"</div>"+
                    "</a>";
                    contenedor.appendChild(div)
                }
            },
            error: function() {
                alert("Ocurrió un error al cargar el contenido.");
            }
        });
    }
</script>
{% endblock %}

{% block up_pop_space %}
<!-- -------------STYLES OF POP UP REPORTAR----------- -->
<style>
    .pop_up_window{
        width: 500px;
    }
    .report_content{
        display: flex;
        flex-direction: column;
    }

    .report_content{
/*        background: blueviolet;*/
        padding: 10px 0px;
        margin: 10px;
    }
    .report_content h3{
        margin: 5px 0px 10px 0px;
    }
    .report_content label{
        font-size: smaller;
        opacity: 80%;
        margin: 3px;
    }
    .report_content textarea{
        background: #D8D8D8;
        height: 60px;
        min-height: 60px;
        max-height: 60px;
        min-width: calc(100% - 14px);
        max-width: calc(100% - 14px);
        padding: 7px;
        border-radius: 4px;
        border: none;
        font-family: 'arial';

    }
    .report_content textarea:focus {
        outline: none;
    }
    .report_content input[type="text"]{
        background: #D8D8D8;
        width: calc(100% - 14px);
        padding: 7px;
        border-radius: 4px;
        border: none;
        font-family: 'arial';
    }
    .report_content input[type="text"]:focus{
        outline: none;
    }
    .report_content button{
        margin: 25px auto 0px auto;
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        background: red;
        color: white;
        cursor: pointer;
    }
    .report_content button:hover{
        background: #D90000;
    }
    #id_admins_r{
        border: 1px solid gray;
    }
    #id_admins_r:focus{
        outline: none;
    }
    .cont_tramite{
        width: 200px;
        height: 30px;
        background: #0064D6;
        color: white;
        border-radius: 5px;
        display: flex;
    }
    .cont_tramite:hover{
        background: #005DC8;
    }
    .cont_tramite label{
/*        background: salmon;*/
        margin: auto;
        height: 100%;
        width: 100%;
        display: flex;
        justify-content: center; /*IMPORTANTE*/
        align-items: center; /*IMPORTANTE*/
        text-align: center;
        opacity: 100%;
        cursor: pointer;
    }
    .cont_tramite img{
        height: 50%;
        margin: auto 5px;
    }
    .report_content_img{
        margin: auto;
        padding: 0px;
        height: 90%;
    }
    .img_pop{
        height: 95%;
        width: auto;
        display: flex;
    }
    .img_pop img{
        height: 100%;
        min-width: 10%;
        max-width: 100%;
        margin: auto;
    }
    #upload_direction{
        display: flex;
        flex-direction: column;

    }
</style>
<div id="pop_windows_report" class="cont_pop ocultar">
    <div id="id_report_content" class="pop_up_window ocultar">
        <div onclick="close_pop_up()" class="close" style="right: 15px;">
          <svg viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="false" focusable="false"><path d="M181.088 135.936l1.536 1.44L512 466.741333l329.376-329.365333a32 32 0 0 1 46.688 43.712l-1.44 1.536L557.258667 512l329.365333 329.376a32 32 0 0 1-43.712 46.688l-1.536-1.44L512 557.258667 182.624 886.624a32 32 0 0 1-46.688-43.712l1.44-1.536L466.741333 512 137.376 182.624a32 32 0 0 1 43.712-46.688z"></path></svg>
        </div>
        <div class="report_content">
            <h3>Reportar</h3>
            <label>Título:</label>
            <input id="tittlee" value="" type="text" placeholder="Ingrese un Título" name="">

            <label>Descripción:</label>
            <textarea id="description" placeholder='Ingrese una Descripción' name=""></textarea>

            <label for="frutas">Cambiar ruta de Reporte:</label>
            <select id="id_admins_r" name="admins">
              <!-- <option value="manzana">Manzana</option> -->
            </select>

            <button onclick="reportar()">Reportar</button>
        </div>
    </div>

    <div id="id_send_baucher" class="pop_up_window ocultar">
        <div onclick="close_pop_up()" class="close" style="right: 15px;">
          <svg viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="false" focusable="false"><path d="M181.088 135.936l1.536 1.44L512 466.741333l329.376-329.365333a32 32 0 0 1 46.688 43.712l-1.44 1.536L557.258667 512l329.365333 329.376a32 32 0 0 1-43.712 46.688l-1.536-1.44L512 557.258667 182.624 886.624a32 32 0 0 1-46.688-43.712l1.44-1.536L466.741333 512 137.376 182.624a32 32 0 0 1 43.712-46.688z"></path></svg>
        </div>
        <div class="report_content">
            <h3>Enviar FUT</h3>
            <label>Numero del Baucher:</label>
            <input id="num_boleta" value="" type="text" placeholder="Ingrese el número de la Baucher" name="">

            <button id="id_process_btn">Procesar</button>
        </div>
    </div>

    <div id="id_publuc_direction" class="pop_up_window ocultar">
        <div onclick="close_pop_up()" class="close" style="right: 15px;">
          <svg viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="false" focusable="false"><path d="M181.088 135.936l1.536 1.44L512 466.741333l329.376-329.365333a32 32 0 0 1 46.688 43.712l-1.44 1.536L557.258667 512l329.365333 329.376a32 32 0 0 1-43.712 46.688l-1.536-1.44L512 557.258667 182.624 886.624a32 32 0 0 1-46.688-43.712l1.44-1.536L466.741333 512 137.376 182.624a32 32 0 0 1 43.712-46.688z"></path></svg>
        </div>
        <div class="report_content">
            <form id="upload_direction" action="{% url 'n_direction_process_doc' %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <h3>PUBLICAR TRAMITE</h3>
                <label>Numero de Expediente:</label>
            
                <input id="num_expediente" value="" type="text" placeholder="Ingrese el número de la Baucher" name="num_expediente">
                
                <label>Archivo de Tramite firmado:</label>
                <div class="cont_tramite">
                    <input type="file" id="pdf_file_direction" style="display: none;" name="file_direction" accept=".pdf">
                    <label id="txt_pdf_direct" for="pdf_file_direction"><img src="{% static 'img/up_file.png' %}">Subir pdf</label>
                </div>
                <input id="select_pdf_direction" type="hidden" name="select_pdf_direction" value="">
                <!-- DATOS DEL FUT -->
                <input type="hidden" name="fut_id_d" value="{{ objs.id }}">
                <input type="hidden" name="order_d" value="{{ objs.order }}">
                <!-- ----- -->
                <input type="hidden" name="admin_id_d" value="{{ Data_log.admin_id }}">
                <input type="hidden" name="user_id_d" value="{{ objs.user_id_id }}">
                <button>Publicar Tramite</button> 
            </form>
        </div>
    </div>

    <div id="id_procces_secretary" class="pop_up_window ocultar">
        <div onclick="close_pop_up()" class="close" style="right: 15px;">
          <svg viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="false" focusable="false"><path d="M181.088 135.936l1.536 1.44L512 466.741333l329.376-329.365333a32 32 0 0 1 46.688 43.712l-1.44 1.536L557.258667 512l329.365333 329.376a32 32 0 0 1-43.712 46.688l-1.536-1.44L512 557.258667 182.624 886.624a32 32 0 0 1-46.688-43.712l1.44-1.536L466.741333 512 137.376 182.624a32 32 0 0 1 43.712-46.688z"></path></svg>
        </div>
        <div class="report_content">
            <h3>PROCESAR TRAMITE</h3>
            <label>Archivo de Tramite firmado:</label>
            <form id="fileUploadForm" action="{% url 'n_secretary_process_doc' %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="cont_tramite">
                    <input type="file" id="pdf_file2_2" style="display: none;" name="file_pdf" accept=".pdf">
                    <label id="text_pdfFile" for="pdf_file2_2"><img src="{% static 'img/up_file.png' %}">Subir pdf</label>
                    <input id="select_pdf" type="hidden" name="reason" value="">
                    <!-- DATOS DEL FUT -->
                    <input type="hidden" name="fut_id_s" value="{{ objs.id }}">
                    <input type="hidden" name="order_s" value="{{ objs.order }}">
                    <!-- ---- -->
                    <input type="hidden" name="admin_id_s" value="{{ Data_log.admin_id }}">
                    <input type="hidden" name="user_id_s" value="{{ objs.user_id_id }}">
                </div>
                <label>Descripcion General del Documento:</label>
                <textarea id="description_general" placeholder='Especifique los requerimientos para su impresion' value="" name="secretary_descript"></textarea>
                <button>Procesar</button>
            </form>
        </div>
    </div>
    <!-- IMAGEN POP-UP CONTENT -->
    <div id="id_pop_img" class="pop_up_window img_pop ocultar">
        <div onclick="close_pop_up()" class="close" style="right: 15px;">
          <svg viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="false" focusable="false"><path d="M181.088 135.936l1.536 1.44L512 466.741333l329.376-329.365333a32 32 0 0 1 46.688 43.712l-1.44 1.536L557.258667 512l329.365333 329.376a32 32 0 0 1-43.712 46.688l-1.536-1.44L512 557.258667 182.624 886.624a32 32 0 0 1-46.688-43.712l1.44-1.536L466.741333 512 137.376 182.624a32 32 0 0 1 43.712-46.688z"></path></svg>
        </div>
        <div id="id_cont_img_pop" class="report_content report_content_img">
            <!-- AQUI VA LA IMAGEN QUE SE GENERA POR JS -->
        </div>
    </div>
</div>
<script>
    function reportar(){
        const tittle = document.getElementById("tittlee").value;
        const description = document.getElementById("description").value;
        const id_fut = fut_id;// Esta variable fue creda en 'view_fut.html'
        const admin_destino = document.getElementById("id_admins_r").value;
        const id_admin_origen = admin_id; // Esta variable fue creda en 'view_fut.html'

        // console.log(tittle);
        // console.log(description);
        // console.log(id_fut);
        // console.log(admin_destino);
        // console.log(id_admin_origen);

        //AJAX
        $.ajax({
            url: "/create_report_path/", // ruta en url.py para que ejecute una funcion
            method: "GET",
            data:{
                'menssage':tittle,
                'description':description,
                'fut_id':id_fut,
                'admin_destino':admin_destino,
                'id_origen_admin':id_admin_origen,
            },
            success: function(response){
                const midata = response; //en response esta recibiendo el return de la funcion
                //NOS REDIRECCIONAMOS
                window.location.href = "http://127.0.0.1:8000/ils_admin/staff_treasury";
            },
            error: function() {
                alert("Ocurrió un error al cargar el contenido.");
            }
        });

    }
    
    function adminsReporte(){
        //Los Admins que existen son: "treasury", "secretary", "direction"
        var adminArray = [];
        var nombres_es = [];

        if(chargeAdmin == "Tesorera"){
            adminArray = ['direction'];
            nombres_es = ['Dirección'];
        }else if(chargeAdmin == "Director"){
            adminArray = ['treasury', 'secretary'];
            nombres_es = ['Tesorería', 'Secretaría'];
        }else{
            adminArray = ['treasury', 'direction'];
            nombres_es = ['Tesorería', 'Dirección'];
        }

        const id_admins_r = document.getElementById("id_admins_r");
        id_admins_r.innerHTML = "";// RESETEAMOS
        // Agregar opciones al elemento select usando un bucle for
        for (var i = 0; i < adminArray.length; i++) {
            var opcion = document.createElement("option");
            opcion.text = nombres_es[i];
            opcion.value = adminArray[i];
            id_admins_r.add(opcion);
        }
    }
    // ENVIAR NUMERO DE BAUCHER FUNCTIONS
    function send_baucher_number(){
        console.log("Enviando Baucher");
        const num_boleta = document.getElementById("num_boleta").value;
        console.log(num_boleta);
    }
</script>

<script src="/static/scripts/admin/script_module.js" type="module" charset="utf-8" async defer></script>
{% endblock %}